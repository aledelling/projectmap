<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moto-Taller - Sistema de Gestión</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="dashboard-container">

        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <i class="fas fa-motorcycle"></i>
                <span>Moto-Taller</span>
            </div>
            <nav class="sidebar-nav">

                <!-- Administrador y Asesor pueden gestionar clientes -->
                {% if session['rol'] in ['administrador', 'asesor'] %}
                <a href="#" class="nav-link active" data-section="clientes">
                    <i class="fas fa-users"></i>
                    <span>Clientes</span>
                </a>
                {% endif %}

                <!-- Administrador, Asesor y Técnico pueden ver órdenes -->
                {% if session['rol'] in ['administrador', 'asesor', 'tecnico'] %}
                <a href="#" class="nav-link" data-section="ordenes">
                    <i class="fas fa-clipboard-list"></i>
                    <span>Órdenes</span>
                </a>
                {% endif %}

                <!-- Administrador y Asesor pueden gestionar Factura -->
                {% if session['rol'] in ['administrador', 'asesor'] %}
                <a href="#" id="menu-facturacion" class="nav-link active" data-section="factura">
                    <i class="fas fa-file-invoice"></i>
                    <span>Facturación</span>
                </a>

                {% endif %}

                <!-- Solo el Administrador puede gestionar inventario -->
                {% if session['rol'] == 'administrador' %}
                <a href="#" class="nav-link" data-section="inventario">
                <i class="fas fa-boxes"></i>
                <span>Inventario</span>
                </a>
                {% endif %}



                    <a href="#" class="nav-link" data-section="encuesta">
                       <i class="fas fa-comments"></i>
                       <span>Encuesta</span>
                    </a>


                <!-- Solo el Administrador puede gestionar servicios -->
                {% if session['rol'] == 'administrador' %}
                <a href="#" class="nav-link" data-section="servicios">
                    <i class="fas fa-tools"></i>
                    <span>Servicios</span>
                </a>


                <!-- Solo el Administrador puede ver reportes -->
                <a href="#" class="nav-link" data-section="reportes">
                    <i class="fas fa-chart-bar"></i>
                    <span>Reportes</span>
                </a>

                <!-- Solo el Administrador puede acceder a configuración -->
                <a href="#" class="nav-link" data-section="configuracion">
                    <i class="fas fa-cog"></i>
                    <span>Configuración</span>
                </a>
                {% endif %}
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">

<!-- Sección: Gestión de Clientes -->
{% if session['rol'] in ['administrador', 'asesor'] %}
<section class="content-section hidden" id="clientes-section">
    <header class="content-header">
        <h1><i class="fas fa-users"></i> Gestión de Clientes</h1>
        <div class="header-actions">
            <div class="search-bar">
                <input type="text" placeholder="Buscar cliente...">
                <button class="search-btn"><i class="fas fa-search"></i></button>
            </div>

            {% if session['rol'] == 'administrador' %}
            <button id="mostrar-formulario-cliente" class="btn btn-primary">
                <i class="fas fa-plus"></i> Nuevo Cliente
            </button>
            {% endif %}
        </div>
    </header>

    <div class="card hidden" id="formulario-cliente">
        <form action="{{ url_for('cliente_bp.nuevo_cliente') }}" method="POST" class="form">
            <div class="form-group">
                <label for="nombre">Nombre:</label>
                <input type="text" name="nombre" required>
            </div>
            <div class="form-group">
                <label for="cedula">Cédula:</label>
                <input type="text" name="cedula" required>
            </div>
            <div class="form-group">
                <label for="celular">Celular:</label>
                <input type="text" name="celular" required>
            </div>
            <div class="form-group">
                <label for="correo">Correo:</label>
                <input type="email" name="correo">
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i> Guardar Cliente
                </button>
                <button type="button" id="cancelar-formulario-cliente" class="btn btn-secondary">Cancelar</button>
            </div>
        </form>
    </div>

    <div class="card">
        <div class="order-cards">
            {% for cliente in clientes %}
            <div class="order-card">
                <div class="order-header">
                    <span class="order-id">#CLI-{{ cliente.id }}</span>
                </div>
                <div class="order-body">
                    <div class="order-info">
                        <span><i class="fas fa-user"></i> {{ cliente.nombre }}</span>
                        <span><i class="fas fa-id-card"></i> {{ cliente.cedula }}</span>
                        <span><i class="fas fa-phone"></i> {{ cliente.celular }}</span>
                        <span><i class="fas fa-envelope"></i> {{ cliente.correo }}</span>
                    </div>
                    <div class="order-actions">
                        <a href="#" class="btn btn-sm btn-icon" title="Editar"><i class="fas fa-edit"></i></a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}


{% if session['rol'] in ['administrador', 'asesor', 'tecnico'] %}
<section class="content-section hidden" id="ordenes-section">
    <header class="content-header">
        <h1><i class="fas fa-clipboard-list"></i> Gestión de Órdenes</h1>
        <div class="header-actions">
            <div class="search-bar">
                <input type="text" placeholder="Buscar órdenes...">
                <button class="search-btn"><i class="fas fa-search"></i></button>
            </div>

            {% if session['rol'] in ['administrador', 'asesor'] %}
            <button type="button" id="mostrar-formulario-orden" class="btn btn-primary">
                <i class="fas fa-plus"></i> Nueva Orden
            </button>
            {% endif %}
        </div>
    </header>

    <div class="card">
        <div class="order-cards">
            {% for orden in ordenes %}
            <div class="order-card status-{{ orden.estado | lower }}">
                <div class="order-header">
                    <span class="order-id">#ORD-{{ orden.id }}</span>
                    <span class="order-status">{{ orden.estado }}</span>
                </div>
                <div class="order-body">
                    <div class="order-info">
                        <span><i class="fas fa-user"></i> {{ orden.cliente.nombre }}</span>
                        <span><i class="fas fa-motorcycle"></i> {{ orden.moto.modelo }}</span>
                        <span><i class="fas fa-calendar"></i> {{ orden.fecha_entrada.strftime('%d/%m/%Y') }}</span>
                    </div>
                    <div class="order-actions">
                        <a href="#" class="btn btn-sm btn-icon" title="Ver"><i class="fas fa-eye"></i></a>
                        <a href="#" class="btn btn-sm btn-icon" title="Editar"><i class="fas fa-edit"></i></a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Formulario de Nueva Orden (oculto al inicio) -->
        {% if session['rol'] in ['administrador', 'asesor'] %}
        <div id="formulario-nueva-orden" class="hidden" style="margin-top: 20px;">
            <form action="{{ url_for('orden.nueva_orden') }}" method="POST" class="form">
                <div class="form-group">
                    <label for="cliente_id">Cliente:</label>
                    <select name="cliente_id" required>
                        {% for cliente in clientes %}
                        <option value="{{ cliente.id }}">{{ cliente.nombre }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="moto_id">Moto:</label>
                    <select name="moto_id" required>
                        {% for moto in motos %}
                        <option value="{{ moto.id }}">{{ moto.placa }} - {{ moto.modelo }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="tecnico_id">Técnico:</label>
                    <select name="tecnico_id" required>
                        {% for tecnico in tecnicos %}
                        <option value="{{ tecnico.id }}">{{ tecnico.nombre }} - {{ tecnico.especialidad }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="descripcion">Descripción:</label>
                    <textarea name="descripcion" rows="4" required></textarea>
                </div>

                <div class="form-group">
                    <label for="fecha_entrada">Fecha de Entrada:</label>
                    <input type="date" name="fecha_entrada" required>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Guardar Orden
                    </button>
                    <button type="button" id="cancelar-formulario-orden" class="btn btn-secondary">Cancelar</button>
                </div>
            </form>
        </div>
        {% endif %}
    </div>
</section>

<script>
    document.getElementById('mostrar-formulario-orden')?.addEventListener('click', () => {
        document.getElementById('formulario-nueva-orden').classList.remove('hidden');
        document.getElementById('mostrar-formulario-orden').classList.add('hidden');
    });

    document.getElementById('cancelar-formulario-orden')?.addEventListener('click', () => {
        document.getElementById('formulario-nueva-orden').classList.add('hidden');
        document.getElementById('mostrar-formulario-orden').classList.remove('hidden');
    });
</script>
{% endif %}


            <!-- Sección: Servicios -->
            <!-- Visible solo para: Administrador -->
            {% if session['rol'] == 'administrador' %}
            <section class="content-section hidden" id="servicios-section">
                <header class="content-header">
                    <h1><i class="fas fa-tools"></i> Servicios</h1>
                    <!-- Contenido interno de servicios... -->
                </header>
            </section>

<!-- Sección: Gestión de Facturas -->
{% if session['rol'] in ['administrador', 'asesor'] %}
<section class="content-section" id="factura-section">
    <header class="content-header">
        <h1><i class="fas fa-file-invoice"></i> Gestión de Facturas</h1>
        <div class="header-actions">
            <div class="search-bar">
                <input type="text" placeholder="Buscar facturas..." id="buscar-facturas">
                <button class="search-btn"><i class="fas fa-search"></i></button>
            </div>

            <button id="mostrar-formulario-factura" class="btn btn-primary">
                <i class="fas fa-plus"></i> Nueva Factura
            </button>
        </div>
    </header>

    <!-- Formulario para nueva factura -->
    <div id="formulario-factura" class="card hidden">
        <form method="POST" action="{{ url_for('factura.generar_desde_dashboard') }}" class="form">
            <div class="form-group">
                <label for="orden_id">Orden de Trabajo:</label>
                <select class="form-control" name="orden_id" id="orden_id" required>
    <option value="">Seleccione una orden...</option>
    {% if ordenes_pendientes %}
        {% for orden in ordenes_pendientes %}
        <option value="{{ orden.id }}" 
                data-subtotal="{{ orden.total_servicios }}">
            ORD-{{ orden.id }} - {{ orden.cliente.nombre }} ({{ orden.moto.placa }})
        </option>
        {% endfor %}
    {% else %}
        <option value="" disabled>No hay órdenes disponibles para facturar</option>
    {% endif %}
</select>
            </div>

            <div class="form-group">
                <label for="subtotal">Subtotal:</label>
                <input type="number" step="0.01" name="subtotal" id="subtotal" required>
            </div>

            <div class="form-group">
                <label>IVA (19%):</label>
                <span id="iva-calculado">$0.00</span>
            </div>

            <div class="form-group">
                <label>Total:</label>
                <span id="total-calculado">$0.00</span>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-save"></i> Generar Factura
                </button>
                <button type="button" id="cancelar-formulario-factura" class="btn btn-secondary">Cancelar</button>
            </div>
        </form>
    </div>

    <!-- Lista de facturas -->
    <div class="card">
        {% if facturas %}
        <div class="order-cards">
            {% for factura in facturas %}
            <div class="order-card">
                <div class="order-header">
                    <span class="order-id">#FAC-{{ factura.id }}</span>
                    <span class="order-status">Total: ${{ "%.2f"|format(factura.total) }}</span>
                </div>
                <div class="order-body">
                    <div class="order-info">
                        <span><i class="fas fa-user"></i> {{ factura.orden.cliente.nombre }}</span>
                        <span><i class="fas fa-motorcycle"></i> {{ factura.orden.moto.modelo }} ({{ factura.orden.moto.placa }})</span>
                        <span><i class="fas fa-calendar"></i> {{ factura.fecha_emision.strftime('%d/%m/%Y %H:%M') }}</span>
                    </div>
                    <div class="order-actions">
                        <a href="{{ url_for('factura.ver_factura', id=factura.id) }}" class="btn btn-sm btn-icon" title="Ver">
                            <i class="fas fa-eye"></i>
                        </a>
                        {% if factura.pdf_path %}
                        <a href="{{ url_for('factura.descargar_factura', id=factura.id) }}" class="btn btn-sm btn-icon" title="Descargar PDF">
                            <i class="fas fa-file-pdf"></i>
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            <i class="fas fa-file-invoice-dollar"></i>
            <p>No hay facturas registradas</p>
        </div>
        {% endif %}
    </div>
</section>

<!-- JavaScript mejorado -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Mostrar/ocultar formulario
    const mostrarBtn = document.getElementById('mostrar-formulario-factura');
    const cancelarBtn = document.getElementById('cancelar-formulario-factura');
    const formulario = document.getElementById('formulario-factura');
    
    if (mostrarBtn && formulario && cancelarBtn) {
        mostrarBtn.addEventListener('click', () => {
            formulario.classList.remove('hidden');
            // Desplazar a la sección del formulario
            formulario.scrollIntoView({ behavior: 'smooth' });
        });
        
        cancelarBtn.addEventListener('click', () => {
            formulario.classList.add('hidden');
            document.getElementById('subtotal').value = '';
            document.getElementById('iva-calculado').textContent = '$0.00';
            document.getElementById('total-calculado').textContent = '$0.00';
        });
    }
    
    // Cálculo automático de IVA y Total
    const subtotalInput = document.getElementById('subtotal');
    const ordenSelect = document.getElementById('orden_id');
    
    function calcularTotales() {
        const subtotal = parseFloat(subtotalInput.value) || 0;
        const iva = subtotal * 0.19;
        const total = subtotal + iva;
        
        document.getElementById('iva-calculado').textContent = '$' + iva.toFixed(2);
        document.getElementById('total-calculado').textContent = '$' + total.toFixed(2);
    }
    
    subtotalInput.addEventListener('input', calcularTotales);
    
    // Autocompletar subtotal basado en la orden seleccionada
    if (ordenSelect) {
        ordenSelect.addEventListener('change', function() {
            const selectedOption = this.options[this.selectedIndex];
            if (selectedOption && selectedOption.dataset.subtotal) {
                subtotalInput.value = selectedOption.dataset.subtotal;
                calcularTotales();
            }
        });
    }
    
    // Búsqueda de facturas
    const buscarInput = document.getElementById('buscar-facturas');
    if (buscarInput) {
        buscarInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            document.querySelectorAll('.order-card').forEach(card => {
                const text = card.textContent.toLowerCase();
                card.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });
    }
});
</script>

<style>
/* Estilos adicionales para mejor visualización */
#formulario-factura {
    transition: all 0.3s ease;
}

.order-card {
    margin-bottom: 1rem;
    border: 1px solid #eee;
    border-radius: 8px;
    padding: 1rem;
    transition: all 0.2s ease;
}

.order-card:hover {
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.empty-state {
    text-align: center;
    padding: 2rem;
    color: #666;
}

.empty-state i {
    font-size: 3rem;
    margin-bottom: 1rem;
    color: #ccc;
}
</style>
{% endif %}

   <!-- Sección: Inventario -->
{% if session['rol'] in ['administrador', 'asesor'] %}
<section class="content-section hidden" id="inventario-section">
    <header class="content-header">
        <h1>Gestión de Inventario</h1>
        <form method="POST">
            <label for="producto">Nombre :</label>
            <input type="text" name="Nombre" id="Nombre" required>

            <label for="cantidad">Referencia:</label>
            <input type="number" name="Referencia" id="Referencia" required min="1">

            <label for="precio"> Cantidad :</label>
            <input type="number" step="0.01" name="Cantidad" id="Cantidad" required>

             <label for="precio"> Precio :</label>
            <input type="number" step="0.01" name="precio" id="precio" required>


            <button type="submit">Agregar al Inventario</button>
        </form>
    </header>
</section>
{% endif %}

<!-- Sección: Reportes -->
<section class="content-section hidden" id="reportes-section">
    <header class="content-header">
        <h1><i class="fas fa-chart-bar"></i> Reportes</h1>
        <!-- Contenido interno de reportes... -->
    </header>
</section>

<!-- Sección: Configuración -->
<section class="content-section hidden" id="configuracion-section">
    <header class="content-header">
        <h1><i class="fas fa-cog"></i> Configuración</h1>
        <!-- Contenido interno de configuración... -->
    </header>
</section>

</main>
</div>

<!-- Sección: Gestión de Facturas -->
<!-- Visible para: Administrador y Asesor -->
{% if session['rol'] in ['administrador', 'asesor'] %}
<section class="content-section hidden" id="factura-section">
    <header class="content-header">
        <h1><i class="fas fa-file-invoice"></i> Gestión de Facturas</h1>
        <div class="header-actions">
            <div class="search-bar">
                <input type="text" placeholder="Buscar facturas..." id="buscar-facturas">
                <button class="search-btn"><i class="fas fa-search"></i></button>
            </div>

            <!-- Botón para mostrar formulario -->
            <button id="mostrar-formulario-factura" class="btn btn-primary">
                <i class="fas fa-plus"></i> Nueva Factura
            </button>
        </div>
    </header>

    <!-- Formulario oculto para crear nueva factura -->
<!-- Formulario para nueva factura -->
<!-- Formulario para nueva factura -->
<div id="formulario-factura" class="card {% if not show_form %}hidden{% endif %}">
    <div class="card-header">
        <h4><i class="fas fa-file-invoice"></i> Nueva Factura</h4>
    </div>
    <div class="card-body">
        <form method="POST" action="{{ url_for('factura.generar_desde_dashboard') }}" enctype="multipart/form-data" id="form-factura">
            <div class="form-group mb-3">
                <label for="orden_id" class="form-label">Orden de Trabajo *</label>
                <select class="form-select" name="orden_id" id="orden_id" required>
                    <option value="">Seleccione una orden...</option>
                    {% if ordenes_pendientes %}
                        {% for orden in ordenes_pendientes %}
                        <option value="{{ orden.id }}" 
                                data-subtotal="{{ orden.total_servicios }}"
                                data-cliente="{{ orden.cliente.nombre }}"
                                data-moto="{{ orden.moto.modelo }} ({{ orden.moto.placa }})">
                            ORD-{{ orden.id }} - {{ orden.cliente.nombre }} ({{ orden.moto.placa }})
                        </option>
                        {% endfor %}
                    {% else %}
                        <option value="" disabled>No hay órdenes pendientes de facturación</option>
                    {% endif %}
                </select>
                <small class="form-text text-muted">Solo se muestran órdenes completadas y no facturadas</small>
            </div>

            <div class="row mb-3">
                <div class="col-md-4">
                    <label for="subtotal" class="form-label">Subtotal *</label>
                    <div class="input-group">
                        <span class="input-group-text">$</span>
                        <input type="number" class="form-control" name="subtotal" id="subtotal" 
                               step="0.01" min="0" required>
                    </div>
                </div>
                <div class="col-md-4">
                    <label class="form-label">IVA (19%)</label>
                    <div class="input-group">
                        <span class="input-group-text">$</span>
                        <input type="text" class="form-control" id="iva-calculado" readonly value="0.00">
                    </div>
                </div>
                <div class="col-md-4">
                    <label class="form-label">Total</label>
                    <div class="input-group">
                        <span class="input-group-text">$</span>
                        <input type="text" class="form-control" id="total-calculado" readonly value="0.00">
                    </div>
                </div>
            </div>

            <div class="d-flex justify-content-between">
                <button type="button" id="cancelar-formulario-factura" class="btn btn-outline-secondary">
                    <i class="fas fa-times me-1"></i> Cancelar
                </button>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save me-1"></i> Generar Factura
                </button>
            </div>
        </form>
    </div>
</div>

    <!-- Lista de facturas ya generadas -->
    <div class="card">
        {% if facturas %}
        <div class="order-cards">
            {% for factura in facturas %}
            <div class="order-card">
                <div class="order-header">
                    <span class="order-id">#FAC-{{ factura.id }}</span>
                    <span class="order-status">Total: ${{ "%.2f"|format(factura.total) }}</span>
                </div>
                <div class="order-body">
                    <div class="order-info">
                        <span><i class="fas fa-user"></i> {{ factura.orden.cliente.nombre }}</span>
                        <span><i class="fas fa-motorcycle"></i> {{ factura.orden.moto.modelo }} ({{ factura.orden.moto.placa }})</span>
                        <span><i class="fas fa-calendar"></i> {{ factura.fecha_emision.strftime('%d/%m/%Y %H:%M') if factura.fecha_emision else 'Fecha no disponible' }}</span>
                    </div>
                    <div class="order-actions">
                        <a href="{{ url_for('factura.ver_factura', id=factura.id) }}" class="btn btn-sm btn-icon" title="Ver"><i class="fas fa-eye"></i></a>
                        <a href="{{ url_for('factura.descargar_factura', id=factura.id) }}" class="btn btn-sm btn-icon" title="Descargar PDF"><i class="fas fa-file-pdf"></i></a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            <i class="fas fa-file-invoice-dollar"></i>
            <p>No hay facturas registradas</p>
        </div>
        {% endif %}
    </div>
</section>

<!-- JavaScript para el manejo del formulario -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Elementos del formulario
    const ordenSelect = document.getElementById('orden_id');
    const subtotalInput = document.getElementById('subtotal');
    const ivaCalculado = document.getElementById('iva-calculado');
    const totalCalculado = document.getElementById('total-calculado');
    const formFactura = document.getElementById('form-factura');
    
    // Función para calcular totales
    function calcularTotales() {
        const subtotal = parseFloat(subtotalInput.value) || 0;
        const iva = subtotal * 0.19;
        const total = subtotal + iva;
        
        ivaCalculado.value = iva.toFixed(2);
        totalCalculado.value = total.toFixed(2);
    }
    
    // Autocompletar subtotal al seleccionar orden
    if (ordenSelect) {
        ordenSelect.addEventListener('change', function() {
            const selectedOption = this.options[this.selectedIndex];
            if (selectedOption && selectedOption.dataset.subtotal) {
                subtotalInput.value = selectedOption.dataset.subtotal;
                calcularTotales();
            }
        });
    }
    
    // Calcular al cambiar el subtotal
    if (subtotalInput) {
        subtotalInput.addEventListener('input', calcularTotales);
    }
    
    // Validación del formulario
    if (formFactura) {
        formFactura.addEventListener('submit', function(e) {
            if (!ordenSelect.value) {
                e.preventDefault();
                alert('Debe seleccionar una orden de trabajo');
                return false;
            }
            
            if (!subtotalInput.value || parseFloat(subtotalInput.value) <= 0) {
                e.preventDefault();
                alert('El subtotal debe ser mayor a cero');
                return false;
            }
            return true;
        });
    }
    
    // Botón cancelar
    const cancelarBtn = document.getElementById('cancelar-formulario-factura');
    if (cancelarBtn) {
        cancelarBtn.addEventListener('click', function() {
            document.getElementById('formulario-factura').classList.add('hidden');
            formFactura.reset();
            ivaCalculado.value = '0.00';
            totalCalculado.value = '0.00';
        });
    }
});
</script>
{% endif %}

     <!-- Sección: Encuesta de Satisfacción -->
<section class="content-section hidden" id="encuesta-section">
    <header class="content-header">
        <h1><i class="fas fa-comments"></i> Encuesta de Satisfacción</h1>
         <h2>FORMULARIO DE SATISFACCION</h2>
    <form action="" method="post">
        <label>Nombre:</label><br>
        <input type="text" name="nombre" required><br><br>

        <label>Correo:</label><br>
        <input type="email" name="correo" required><br><br>

        <label>¿Encontraste fácilmente la información que buscabas?</label><br>
        <select name="p1">
            <option value="1">Si</option>
            <option value="2">No</option>
        </select><br><br>

        <label>¿Qué tan satisfecho estás con tu experiencia?</label><br>
        <select name="p2">
            <option value="1">Muy Malo</option>
            <option value="2">Malo</option>
            <option value="3">Regular</option>
            <option value="4">Bueno</option>
            <option value="5">Excelente</option>
        </select><br><br>

        <label>¿Qué te parece el diseño visual?</label><br>
        <select name="p3">
            <option value="1">Muy Malo</option>
            <option value="2">Malo</option>
            <option value="3">Regular</option>
            <option value="4">Bueno</option>
            <option value="5">Excelente</option>
        </select><br><br>

        <label>¿El proceso de compra fue claro y sencillo?</label><br>
        <select name="p4">
            <option value="SI">Sí</option>
            <option value="NO">No</option>
        </select><br><br>

        <label>¿Cuánto recomendarías nuestro sitio (1-10)?</label><br>
        <select name="p5">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
            <option value="10">10</option>
        </select><br><br>

        <label>¿Por qué recomendarías nuestros servicios?</label><br>
        <textarea name="comentario1"></textarea><br><br>

        <label>¿Qué podríamos mejorar?</label><br>
        <textarea name="comentario2"></textarea><br><br>

        <input type="submit" style="color: red;" value="Enviar">
    </form>
    </header>
   
</section>


            <!-- Sección: Reportes -->
            <section class="content-section hidden" id="reportes-section">
                <header class="content-header">
                    <h1><i class="fas fa-chart-bar"></i> Reportes</h1>
                    <!-- Contenido interno de reportes... -->
                </header>
            </section>

            <!-- Sección: Configuración -->
            <section class="content-section hidden" id="configuracion-section">
                <header class="content-header">
                    <h1><i class="fas fa-cog"></i> Configuración</h1>
                    <!-- Contenido interno de configuración... -->
                </header>
            </section>
            {% endif %}
        </main>
    </div>
     <!-- Sección: Encuesta de Satisfacción -->
<section class="content-section hidden" id="encuesta-section">
    <header class="content-header">
        <h1><i class="fas fa-comments"></i> Encuesta de Satisfacción</h1>
         <h2>FORMULARIO DE SATISFACCION</h2>
    <form action="" method="post">
        <label>Nombre:</label><br>
        <input type="text" name="nombre" required><br><br>

        <label>Correo:</label><br>
        <input type="email" name="correo" required><br><br>

        <label>¿Encontraste fácilmente la información que buscabas?</label><br>
        <select name="p1">
            <option value="1">Si</option>
            <option value="2">No</option>
        </select><br><br>

        <label>¿Qué tan satisfecho estás con tu experiencia?</label><br>
        <select name="p2">
            <option value="1">Muy Malo</option>
            <option value="2">Malo</option>
            <option value="3">Regular</option>
            <option value="4">Bueno</option>
            <option value="5">Excelente</option>
        </select><br><br>

        <label>¿Qué te parece el diseño visual?</label><br>
        <select name="p3">
            <option value="1">Muy Malo</option>
            <option value="2">Malo</option>
            <option value="3">Regular</option>
            <option value="4">Bueno</option>
            <option value="5">Excelente</option>
        </select><br><br>

        <label>¿El proceso de compra fue claro y sencillo?</label><br>
        <select name="p4">
            <option value="SI">Sí</option>
            <option value="NO">No</option>
        </select><br><br>

        <label>¿Cuánto recomendarías nuestro sitio (1-10)?</label><br>
        <select name="p5">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
            <option value="10">10</option>
        </select><br><br>

        <label>¿Por qué recomendarías nuestros servicios?</label><br>
        <textarea name="comentario1"></textarea><br><br>

        <label>¿Qué podríamos mejorar?</label><br>
        <textarea name="comentario2"></textarea><br><br>

        <input type="submit" style="color: red;" value="Enviar">
    </form>
    </header>
   
</section>

    <script>
        // Variables globales
        let repuestos = [];
        let searchTimeout;
        let nextId = 1;

        // Datos de demostración
        const datosDemo = [
            { id: 1, nombre: "Filtro de Aceite", marca: "Honda", referencia: "15410-MEN-A01", cantidad: 25, precio: 15000 },
            { id: 2, nombre: "Pastillas de Freno", marca: "Yamaha", referencia: "5SL-W0045-00", cantidad: 8, precio: 45000 },
            { id: 3, nombre: "Cadena 428", marca: "DID", referencia: "428HD-120", cantidad: 0, precio: 85000 },
            { id: 4, nombre: "Bujía", marca: "NGK", referencia: "CR8E", cantidad: 50, precio: 12000 },
            { id: 5, nombre: "Aceite 4T", marca: "Castrol", referencia: "15W40-1L", cantidad: 15, precio: 18000 }
        ];

        // Cargar datos de demostración al inicio
        function cargarDatosDemo() {
            repuestos = [...datosDemo];
            nextId = Math.max(...repuestos.map(r => r.id)) + 1;
        }

        // Mostrar alerta
        function mostrarAlerta(mensaje, tipo) {
            const alert = document.getElementById('alert');
            alert.textContent = mensaje;
            alert.className = `alert alert-${tipo}`;
            alert.style.display = 'block';
            
            setTimeout(() => {
                alert.style.display = 'none';
            }, 3000);
        }

        // Calcular estadísticas
        function calcularEstadisticas() {
            const stats = {
                total_repuestos: repuestos.length,
                stock_bajo: repuestos.filter(r => r.cantidad > 0 && r.cantidad < 10).length,
                sin_stock: repuestos.filter(r => r.cantidad === 0).length,
                valor_total: repuestos.reduce((total, r) => total + (r.cantidad * r.precio), 0)
            };

            document.getElementById('totalRepuestos').textContent = stats.total_repuestos;
            document.getElementById('stockBajo').textContent = stats.stock_bajo;
            document.getElementById('sinStock').textContent = stats.sin_stock;
            document.getElementById('valorTotal').textContent = new Intl.NumberFormat('es-CO', {
                style: 'currency',
                currency: 'COP'
            }).format(stats.valor_total);
        }

        // Cargar repuestos (simulación de API)
        function cargarRepuestos(search = '') {
            document.getElementById('loadingIndicator').style.display = 'block';
            document.getElementById('inventoryTable').style.display = 'none';
            document.getElementById('emptyState').style.display = 'none';
            
            // Simular delay de red
            setTimeout(() => {
                let repuestosFiltrados = repuestos;
                
                if (search) {
                    const searchLower = search.toLowerCase();
                    repuestosFiltrados = repuestos.filter(r => 
                        r.nombre.toLowerCase().includes(searchLower) ||
                        r.marca.toLowerCase().includes(searchLower) ||
                        r.referencia.toLowerCase().includes(searchLower)
                    );
                }
                
                renderizarTabla(repuestosFiltrados);
                calcularEstadisticas();
                
                document.getElementById('loadingIndicator').style.display = 'none';
                
                if (repuestosFiltrados.length === 0) {
                    document.getElementById('emptyState').style.display = 'block';
                    document.getElementById('inventoryTable').style.display = 'none';
                } else {
                    document.getElementById('inventoryTable').style.display = 'table';
                }
            }, 300);
        }

        // Renderizar tabla
        function renderizarTabla(repuestosAMostrar = repuestos) {
            const tbody = document.getElementById('repuestosTableBody');
            tbody.innerHTML = '';

            repuestosAMostrar.forEach(repuesto => {
                const row = document.createElement('tr');
                
                // Agregar clases para indicar stock
                if (repuesto.cantidad === 0) {
                    row.classList.add('out-of-stock');
                } else if (repuesto.cantidad < 10) {
                    row.classList.add('low-stock');
                }

                row.innerHTML = `
                    <td>${repuesto.id}</td>
                    <td>${repuesto.nombre}</td>
                    <td>${repuesto.marca}</td>
                    <td>${repuesto.referencia}</td>
                    <td>${repuesto.cantidad}</td>
                    <td>${new Intl.NumberFormat('es-CO', { style: 'currency', currency: 'COP' }).format(repuesto.precio)}</td>
                    <td>${new Intl.NumberFormat('es-CO', { style: 'currency', currency: 'COP' }).format(repuesto.cantidad * repuesto.precio)}</td>
                    <td>
                        <button class="btn btn-edit" onclick="editarRepuesto(${repuesto.id})">Editar</button>
                        <button class="btn btn-danger" onclick="eliminarRepuesto(${repuesto.id})">Eliminar</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Manejar formulario
        function manejarFormulario(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const repuesto = {
                nombre: formData.get('nombre').trim(),
                marca: formData.get('marca').trim(),
                referencia: formData.get('referencia').trim(),
                cantidad: parseInt(formData.get('cantidad')),
                precio: parseFloat(formData.get('precio'))
            };

            // Validaciones
            if (!repuesto.nombre || !repuesto.marca || !repuesto.referencia) {
                mostrarAlerta('Todos los campos son requeridos', 'error');
                return;
            }

            const editId = document.getElementById('editId').value;

            try {
                if (editId) {
                    // Actualizar repuesto existente
                    const index = repuestos.findIndex(r => r.id === parseInt(editId));
                    if (index !== -1) {
                        repuestos[index] = { ...repuesto, id: parseInt(editId) };
                        mostrarAlerta('Repuesto actualizado exitosamente', 'success');
                    }
                } else {
                    // Verificar si ya existe la referencia
                    if (repuestos.find(r => r.referencia === repuesto.referencia)) {
                        mostrarAlerta('Ya existe un repuesto con esa referencia', 'error');
                        return;
                    }
                    
                    // Crear nuevo repuesto
                    repuesto.id = nextId++;
                    repuestos.push(repuesto);
                    mostrarAlerta('Repuesto agregado exitosamente', 'success');
                }

                e.target.reset();
                if (editId) {
                    cancelEdit();
                }
                cargarRepuestos();
            } catch (error) {
                console.error('Error:', error);
                mostrarAlerta('Error al procesar la solicitud', 'error');
            }
        }

        // Editar repuesto
        function editarRepuesto(id) {
            const repuesto = repuestos.find(r => r.id === id);
            if (repuesto) {
                document.getElementById('editId').value = repuesto.id;
                document.getElementById('nombre').value = repuesto.nombre;
                document.getElementById('marca').value = repuesto.marca;
                document.getElementById('referencia').value = repuesto.referencia;
                document.getElementById('cantidad').value = repuesto.cantidad;
                document.getElementById('precio').value = repuesto.precio;
                
                document.getElementById('submitBtn').textContent = 'Actualizar Repuesto';
                document.getElementById('cancelBtn').style.display = 'inline-block';
                
                // Scroll al formulario
                document.querySelector('.form-section').scrollIntoView({ behavior: 'smooth' });
            }
        }

        // Cancelar edición
        function cancelEdit() {
            document.getElementById('editId').value = '';
            document.getElementById('repuestoForm').reset();
            document.getElementById('submitBtn').textContent = 'Agregar Repuesto';
            document.getElementById('cancelBtn').style.display = 'none';
        }

        // Eliminar repuesto
        function eliminarRepuesto(id) {
            if (confirm('¿Estás seguro de que quieres eliminar este repuesto?')) {
                try {
                    const index = repuestos.findIndex(r => r.id === id);
                    if (index !== -1) {
                        repuestos.splice(index, 1);
                        mostrarAlerta('Repuesto eliminado exitosamente', 'success');
                        cargarRepuestos();
                    }
                } catch (error) {
                    console.error('Error:', error);
                    mostrarAlerta('Error al eliminar el repuesto', 'error');
                }
            }
        }

        // Filtrar repuestos
        function filtrarRepuestos() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                const searchTerm = document.getElementById('searchInput').value;
                cargarRepuestos(searchTerm);
            }, 300);
        }

        // Event listeners
        document.getElementById('repuestoForm').addEventListener('submit', manejarFormulario);
        document.getElementById('searchInput').addEventListener('input', filtrarRepuestos);

        // Inicializar aplicación
        document.addEventListener('DOMContentLoaded', function() {
            cargarDatosDemo();
            cargarRepuestos();
            mostrarAlerta('Sistema de inventario cargado correctamente', 'success');
        });
    </script>
</body>
</html>
    <script>   
    document.querySelectorAll('.sidebar-nav .nav-link').forEach(link => {
        link.addEventListener('click', function (e) {
            e.preventDefault();

            // Ocultar todas las secciones
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.add('hidden');
            });

            // Mostrar la sección correspondiente al data-section
            const targetId = this.getAttribute('data-section') + '-section';
            const targetSection = document.getElementById(targetId);
            if (targetSection) {
                targetSection.classList.remove('hidden');
            }
        });
    });
    </script>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>

<script>
document.getElementById('mostrar-formulario-cliente')?.addEventListener('click', function () {
    document.getElementById('formulario-cliente').classList.remove('hidden');
    this.classList.add('hidden');
});

document.getElementById('cancelar-formulario-cliente')?.addEventListener('click', function () {
    document.getElementById('formulario-cliente').classList.add('hidden');
    document.getElementById('mostrar-formulario-cliente').classList.remove('hidden');
});
</script>


</body>
</html>
