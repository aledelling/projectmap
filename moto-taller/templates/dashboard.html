<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moto-Taller - Sistema de Gestión</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="dashboard-container">

        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <i class="fas fa-motorcycle"></i>
                <span>Moto-Taller</span>
            </div>
            <nav class="sidebar-nav">

                <!-- Administrador y Asesor pueden gestionar clientes -->
                {% if session['rol'] in ['administrador', 'asesor'] %}
                <a href="#" class="nav-link active" data-section="clientes">
                    <i class="fas fa-users"></i>
                    <span>Clientes</span>
                </a>
                {% endif %}

                <!-- Administrador, Asesor y Técnico pueden ver órdenes -->
                {% if session['rol'] in ['administrador', 'asesor', 'tecnico'] %}
                <a href="#" class="nav-link" data-section="ordenes">
                    <i class="fas fa-clipboard-list"></i>
                    <span>Órdenes</span>
                </a>
                {% endif %}

                <!-- Solo el Administrador puede gestionar servicios -->
                {% if session['rol'] == 'administrador' %}
                <a href="#" class="nav-link" data-section="servicios">
                    <i class="fas fa-tools"></i>
                    <span>Servicios</span>
                </a>

                <!-- Administrador y Asesor pueden gestionar Factura -->
                {% if session['rol'] in ['administrador', 'asesor'] %}
                <a href="#" id="menu-facturacion" class="nav-link active" data-section="factura">
                    <i class="fas fa-file-invoice"></i>
                    <span>Facturación</span>
                </a>

                {% endif %}




                <!-- Solo el Administrador puede ver reportes -->
                <a href="#" class="nav-link" data-section="reportes">
                    <i class="fas fa-chart-bar"></i>
                    <span>Reportes</span>
                </a>

                <!-- Solo el Administrador puede acceder a configuración -->
                <a href="#" class="nav-link" data-section="configuracion">
                    <i class="fas fa-cog"></i>
                    <span>Configuración</span>
                </a>
                {% endif %}
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">

<!-- Sección: Gestión de Clientes -->
{% if session['rol'] in ['administrador', 'asesor'] %}
<section class="content-section hidden" id="clientes-section">
    <header class="content-header">
        <h1><i class="fas fa-users"></i> Gestión de Clientes</h1>
        <div class="header-actions">
            <div class="search-bar">
                <input type="text" placeholder="Buscar cliente...">
                <button class="search-btn"><i class="fas fa-search"></i></button>
            </div>

            {% if session['rol'] == 'administrador' %}
            <button id="mostrar-formulario-cliente" class="btn btn-primary">
                <i class="fas fa-plus"></i> Nuevo Cliente
            </button>
            {% endif %}
        </div>
    </header>

    <div class="card hidden" id="formulario-cliente">
        <form action="{{ url_for('cliente_bp.nuevo_cliente') }}" method="POST" class="form">
            <div class="form-group">
                <label for="nombre">Nombre:</label>
                <input type="text" name="nombre" required>
            </div>
            <div class="form-group">
                <label for="cedula">Cédula:</label>
                <input type="text" name="cedula" required>
            </div>
            <div class="form-group">
                <label for="celular">Celular:</label>
                <input type="text" name="celular" required>
            </div>
            <div class="form-group">
                <label for="correo">Correo:</label>
                <input type="email" name="correo">
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i> Guardar Cliente
                </button>
                <button type="button" id="cancelar-formulario-cliente" class="btn btn-secondary">Cancelar</button>
            </div>
        </form>
    </div>

    <div class="card">
        <div class="order-cards">
            {% for cliente in clientes %}
            <div class="order-card">
                <div class="order-header">
                    <span class="order-id">#CLI-{{ cliente.id }}</span>
                </div>
                <div class="order-body">
                    <div class="order-info">
                        <span><i class="fas fa-user"></i> {{ cliente.nombre }}</span>
                        <span><i class="fas fa-id-card"></i> {{ cliente.cedula }}</span>
                        <span><i class="fas fa-phone"></i> {{ cliente.celular }}</span>
                        <span><i class="fas fa-envelope"></i> {{ cliente.correo }}</span>
                    </div>
                    <div class="order-actions">
                        <a href="#" class="btn btn-sm btn-icon" title="Editar"><i class="fas fa-edit"></i></a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}


            <!-- Sección: Gestión de Órdenes -->
            <!-- Visible para: Administrador, Asesor y Técnico -->
           <!-- Sección: Gestión de Órdenes -->
<!-- Visible para: Administrador, Asesor y Técnico -->
{% if session['rol'] in ['administrador', 'asesor', 'tecnico'] %}
<section class="content-section hidden" id="ordenes-section">
    <header class="content-header">
        <h1><i class="fas fa-clipboard-list"></i> Gestión de Órdenes</h1>
        <div class="header-actions">
            <div class="search-bar">
                <input type="text" placeholder="Buscar órdenes...">
                <button class="search-btn"><i class="fas fa-search"></i></button>
            </div>

            <!-- Crear orden: solo Administrador y Asesor -->
            {% if session['rol'] in ['administrador', 'asesor'] %}
            <a href="{{ url_for('orden.nueva_orden') }}" class="btn btn-primary">
                <i class="fas fa-plus"></i> Nueva Orden
            </a>
            {% endif %}
        </div>
    </header>

    <div class="card">
        <div class="order-cards">
            {% for orden in ordenes %}
            <div class="order-card status-{{ orden.estado | lower }}">
                <div class="order-header">
                    <span class="order-id">#ORD-{{ orden.id }}</span>
                    <span class="order-status">{{ orden.estado }}</span>
                </div>
                <div class="order-body">
                    <div class="order-info">
                        <span><i class="fas fa-user"></i> {{ orden.cliente.nombre }}</span>
                        <span><i class="fas fa-motorcycle"></i> {{ orden.moto.modelo }}</span>
                        <span><i class="fas fa-calendar"></i> {{ orden.fecha_entrada.strftime('%d/%m/%Y') }}</span>
                    </div>
                    <div class="order-actions">
                        <a href="#" class="btn btn-sm btn-icon" title="Ver"><i class="fas fa-eye"></i></a>
                        <a href="#" class="btn btn-sm btn-icon" title="Editar"><i class="fas fa-edit"></i></a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}


            <!-- Sección: Servicios -->
            <!-- Visible solo para: Administrador -->
            {% if session['rol'] == 'administrador' %}
            <section class="content-section hidden" id="servicios-section">
                <header class="content-header">
                    <h1><i class="fas fa-tools"></i> Servicios</h1>
                    <!-- Contenido interno de servicios... -->
                </header>
            </section>

             <!-- Sección: Facturación -->
            {% if session['rol'] in ['administrador', 'asesor'] %}
            <section class="content-section hidden" id="factura-section">
                <header class="content-header">
                    <h1>Generar Factura</h1>
                     <form method="POST">
                        <label for="orden_id">Orden:</label>
                         <select name="orden_id" required>
            {% for orden in ordenes %}
                <option value="{{ orden.id }}">Orden #{{ orden.id }} - {{ orden.cliente }} ({{ orden.placa }})</option>
            {% endfor %}
             </select>

        <label for="subtotal">Subtotal:</label>
        <input type="number" step="0.01" name="subtotal" required>

        <button type="submit">Generar Factura</button>

           
    </form>
                </header>
            </section>
            {% endif %}


            <!-- Sección: Reportes -->
            <section class="content-section hidden" id="reportes-section">
                <header class="content-header">
                    <h1><i class="fas fa-chart-bar"></i> Reportes</h1>
                    <!-- Contenido interno de reportes... -->
                </header>
            </section>

            <!-- Sección: Configuración -->
            <section class="content-section hidden" id="configuracion-section">
                <header class="content-header">
                    <h1><i class="fas fa-cog"></i> Configuración</h1>
                    <!-- Contenido interno de configuración... -->
                </header>
            </section>
            {% endif %}
        </main>
    </div>
    <script>
    document.querySelectorAll('.sidebar-nav .nav-link').forEach(link => {
        link.addEventListener('click', function (e) {
            e.preventDefault();

            // Ocultar todas las secciones
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.add('hidden');
            });

            // Mostrar la sección correspondiente al data-section
            const targetId = this.getAttribute('data-section') + '-section';
            const targetSection = document.getElementById(targetId);
            if (targetSection) {
                targetSection.classList.remove('hidden');
            }
        });
    });
    </script>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>

<script>
document.getElementById('mostrar-formulario-cliente')?.addEventListener('click', function () {
    document.getElementById('formulario-cliente').classList.remove('hidden');
    this.classList.add('hidden');
});

document.getElementById('cancelar-formulario-cliente')?.addEventListener('click', function () {
    document.getElementById('formulario-cliente').classList.add('hidden');
    document.getElementById('mostrar-formulario-cliente').classList.remove('hidden');
});
</script>
    
</body>
</html>
